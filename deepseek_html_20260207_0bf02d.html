<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Modelo Conceptual – Reposicionamento Premium do Porto</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Paleta principal - Modo escuro académico */
      --bg-primary: #0a0f1a;
      --bg-secondary: #101827;
      --bg-card: #151d2e;
      --bg-hover: #1a2438;
      
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      
      /* Cores das variáveis */
      --core-primary: #10b981;
      --core-light: #34d399;
      --core-bg: rgba(16, 185, 129, 0.08);
      --core-border: rgba(16, 185, 129, 0.3);
      
      --support-primary: #3b82f6;
      --support-light: #60a5fa;
      --support-bg: rgba(59, 130, 246, 0.08);
      --support-border: rgba(59, 130, 246, 0.3);
      
      --outcome-primary: #f59e0b;
      --outcome-light: #fbbf24;
      --outcome-bg: rgba(245, 158, 11, 0.1);
      --outcome-border: rgba(245, 158, 11, 0.4);
      
      /* Acentos */
      --accent-purple: #8b5cf6;
      --accent-rose: #f43f5e;
      --accent-cyan: #06b6d4;
      
      /* Espaçamento */
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
      --radius-xl: 24px;
      
      /* Sombras */
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.4);
      --shadow-lg: 0 8px 32px rgba(0,0,0,0.5);
      --shadow-glow-core: 0 0 20px rgba(16, 185, 129, 0.3);
      --shadow-glow-support: 0 0 20px rgba(59, 130, 246, 0.3);
      --shadow-glow-outcome: 0 0 24px rgba(245, 158, 11, 0.4);
      
      /* Transições */
      --transition-fast: 150ms ease;
      --transition-normal: 250ms ease;
      --transition-slow: 400ms ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }

    html {
      scroll-behavior: smooth;
    }

    body {
      font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Textura de fundo */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: 
        radial-gradient(ellipse at 20% 0%, rgba(16, 185, 129, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 100%, rgba(59, 130, 246, 0.06) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(245, 158, 11, 0.04) 0%, transparent 60%);
      pointer-events: none;
      z-index: 0;
    }

    /* ═══════════════════════════════════════════
       HEADER
    ═══════════════════════════════════════════ */
    header {
      position: relative;
      z-index: 10;
      padding: 20px 32px;
      background: linear-gradient(180deg, var(--bg-secondary) 0%, transparent 100%);
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .header-content {
      max-width: 1600px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 24px;
      flex-wrap: wrap;
    }

    .header-text h1 {
      font-family: 'Playfair Display', Georgia, serif;
      font-size: 1.6rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      margin-bottom: 6px;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--outcome-light) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header-text p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      max-width: 650px;
      line-height: 1.5;
    }

    .header-text .orientador {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 4px;
    }

    .header-text .orientador strong {
      color: var(--accent-cyan);
    }

    .header-actions {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 500;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--bg-card);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all var(--transition-fast);
      touch-action: manipulation;
      min-height: 36px;
    }

    .btn:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
      border-color: rgba(255,255,255,0.2);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--outcome-primary) 0%, #d97706 100%);
      border-color: var(--outcome-primary);
      color: #000;
    }

    .btn-primary:hover {
      box-shadow: var(--shadow-glow-outcome);
      transform: translateY(-1px);
    }

    .btn svg {
      width: 16px;
      height: 16px;
    }

    /* Tabs de navegação */
    .nav-tabs {
      display: flex;
      gap: 4px;
      padding: 0 32px;
      background: var(--bg-secondary);
      border-bottom: 1px solid rgba(255,255,255,0.05);
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }

    .nav-tabs::-webkit-scrollbar {
      display: none;
    }

    .nav-tab {
      padding: 12px 20px;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--text-muted);
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      cursor: pointer;
      transition: all var(--transition-fast);
      white-space: nowrap;
      flex-shrink: 0;
      touch-action: manipulation;
    }

    .nav-tab:hover {
      color: var(--text-secondary);
      background: rgba(255,255,255,0.02);
    }

    .nav-tab.active {
      color: var(--outcome-light);
      border-bottom-color: var(--outcome-primary);
    }

    /* ═══════════════════════════════════════════
       MAIN LAYOUT
    ═══════════════════════════════════════════ */
    main {
      position: relative;
      z-index: 1;
      flex: 1;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
      padding: 20px 32px 32px;
      max-width: 1600px;
      margin: 0 auto;
      width: 100%;
    }

    /* Painéis de conteúdo (tabs) */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
      grid-column: 1 / -1;
    }

    .tab-content.active.single-column {
      grid-template-columns: 1fr;
    }

    /* ═══════════════════════════════════════════
       DIAGRAM PANEL
    ═══════════════════════════════════════════ */
    .diagram-panel {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 20px;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden;
    }

    .diagram-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .panel-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .legend {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      box-shadow: 0 0 8px currentColor;
    }

    .legend-dot.core { background: var(--core-primary); color: var(--core-primary); }
    .legend-dot.support { background: var(--support-primary); color: var(--support-primary); }
    .legend-dot.outcome { background: var(--outcome-primary); color: var(--outcome-primary); }

    /* Canvas do diagrama */
    .diagram-canvas {
      flex: 1;
      position: relative;
      min-height: 480px;
    }

    .diagram-svg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
    }

    .diagram-svg path {
      fill: none;
      stroke-width: 2;
      stroke-linecap: round;
      transition: all var(--transition-normal);
    }

    .diagram-svg path.core-path { stroke: var(--core-primary); opacity: 0.4; }
    .diagram-svg path.support-path { stroke: var(--support-primary); opacity: 0.4; }
    .diagram-svg path.outcome-path { stroke: var(--outcome-primary); opacity: 0.5; }

    .diagram-svg path.highlighted {
      opacity: 1;
      stroke-width: 3;
      filter: drop-shadow(0 0 6px currentColor);
    }

    /* Animação de fluxo nas setas */
    .diagram-svg path.animated {
      stroke-dasharray: 8 4;
      animation: flowAnimation 1s linear infinite;
    }

    @keyframes flowAnimation {
      from { stroke-dashoffset: 12; }
      to { stroke-dashoffset: 0; }
    }

    .diagram-svg path.highlighted.animated {
      stroke-dasharray: 12 6;
      animation: flowAnimationHighlight 0.8s linear infinite;
    }

    @keyframes flowAnimationHighlight {
      from { stroke-dashoffset: 18; }
      to { stroke-dashoffset: 0; }
    }

    .diagram-svg .arrow-head {
      fill: currentColor;
      transition: all var(--transition-normal);
    }

    /* Nós do diagrama */
    .nodes-container {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 10px 0;
    }

    .node-row {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .node-row.outcome-row {
      justify-content: center;
    }

    .node {
      position: relative;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 12px 16px;
      min-width: 160px;
      max-width: 190px;
      text-align: center;
      cursor: pointer;
      transition: all var(--transition-normal);
      border: 1px solid transparent;
      touch-action: manipulation;
    }

    .node::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      border-radius: var(--radius-md) var(--radius-md) 0 0;
      transition: all var(--transition-normal);
    }

    /* Tipos de nó */
    .node-core {
      background: var(--core-bg);
      border-color: var(--core-border);
    }
    .node-core::before { background: var(--core-primary); }
    .node-core:hover, .node-core.active {
      border-color: var(--core-primary);
      box-shadow: var(--shadow-glow-core);
      transform: translateY(-3px);
      opacity: 1 !important;
      visibility: visible !important;
    }
    
    /* Tag visível em hover/active para core */
    .node-core:hover .node-tag,
    .node-core.active .node-tag {
      background: rgba(16, 185, 129, 0.3) !important;
      border-color: rgba(16, 185, 129, 0.5) !important;
      color: #a7f3d0 !important;
    }

    .node-support {
      background: var(--support-bg);
      border-color: var(--support-border);
    }
    .node-support::before { background: var(--support-primary); }
    .node-support:hover, .node-support.active {
      border-color: var(--support-primary);
      box-shadow: var(--shadow-glow-support);
      transform: translateY(-3px);
      opacity: 1 !important;
      visibility: visible !important;
    }
    
    /* Tag visível em hover/active para support */
    .node-support:hover .node-tag,
    .node-support.active .node-tag {
      background: rgba(59, 130, 246, 0.3) !important;
      border-color: rgba(59, 130, 246, 0.5) !important;
      color: #bfdbfe !important;
    }

    .node-outcome {
      background: var(--outcome-bg);
      border-color: var(--outcome-border);
      min-width: 200px;
    }
    .node-outcome::before { background: linear-gradient(90deg, var(--outcome-primary), var(--outcome-light)); height: 4px; }
    
    /* Pulse animation para o resultado */
    .node-outcome {
      animation: outcomePulse 3s ease-in-out infinite;
    }

    @keyframes outcomePulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.2); }
      50% { box-shadow: 0 0 0 8px rgba(245, 158, 11, 0); }
    }

    .node-outcome:hover, .node-outcome.active {
      animation: none;
      border-color: var(--outcome-primary);
      box-shadow: var(--shadow-glow-outcome);
      transform: translateY(-3px) scale(1.02);
      opacity: 1 !important;
      visibility: visible !important;
    }

    /* GARANTIR que a tag do outcome fica SEMPRE visível em hover e active */
    .node-outcome:hover .node-tag,
    .node-outcome.active .node-tag,
    .node-outcome:hover .tag-outcome,
    .node-outcome.active .tag-outcome {
      background: #78350f !important;
      border: 1px solid #fbbf24 !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      opacity: 1 !important;
      visibility: visible !important;
    }

    .node-code {
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      margin-bottom: 4px;
      opacity: 0.7;
    }

    .node-core .node-code { color: var(--core-light); }
    .node-support .node-code { color: var(--support-light); }
    .node-outcome .node-code { color: var(--outcome-light); }

    .node-title {
      font-size: 0.85rem;
      font-weight: 600;
      line-height: 1.3;
      margin-bottom: 6px;
      color: var(--text-primary);
    }

    .node-tag {
      font-size: 0.65rem;
      padding: 4px 10px;
      border-radius: 999px;
      display: inline-block;
      background: rgba(0,0,0,0.4);
      color: #e2e8f0;
      border: 1px solid rgba(255,255,255,0.1);
    }

    /* Tags específicas por tipo de nó */
    .node-core .node-tag {
      background: rgba(16, 185, 129, 0.2);
      border-color: rgba(16, 185, 129, 0.3);
      color: #a7f3d0;
    }

    .node-support .node-tag {
      background: rgba(59, 130, 246, 0.2);
      border-color: rgba(59, 130, 246, 0.3);
      color: #bfdbfe;
    }

    /* Tag do nó outcome - MÁXIMA VISIBILIDADE */
    .node-outcome .node-tag {
      background: #78350f !important;
      border: 1px solid #fbbf24 !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
    }
    
    .node-tag.tag-outcome {
      background: #78350f !important;
      border: 1px solid #fbbf24 !important;
      color: #ffffff !important;
      font-weight: 600 !important;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important;
    }

    /* Tooltip nos nós */
    .node-tooltip {
      position: absolute;
      bottom: calc(100% + 8px);
      left: 50%;
      transform: translateX(-50%) scale(0.9);
      background: var(--bg-primary);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: var(--radius-sm);
      padding: 8px 12px;
      font-size: 0.75rem;
      color: var(--text-secondary);
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: all var(--transition-fast);
      z-index: 100;
      box-shadow: var(--shadow-md);
    }

    .node-tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 6px solid transparent;
      border-top-color: rgba(255,255,255,0.15);
    }

    .node:hover .node-tooltip {
      opacity: 1;
      transform: translateX(-50%) scale(1);
    }

    /* ═══════════════════════════════════════════
       DETAILS PANEL
    ═══════════════════════════════════════════ */
    .details-panel {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 14px;
      position: relative;
      overflow: hidden;
      max-height: calc(100vh - 200px);
      overflow-y: auto;
    }

    .details-panel::-webkit-scrollbar {
      width: 6px;
    }

    .details-panel::-webkit-scrollbar-track {
      background: transparent;
    }

    .details-panel::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
    }

    .details-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
    }

    .details-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
    }

    .details-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.1rem;
      font-weight: 600;
      line-height: 1.3;
    }

    .details-badge {
      font-size: 0.65rem;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      padding: 4px 10px;
      border-radius: 999px;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .badge-core {
      background: var(--core-bg);
      border: 1px solid var(--core-border);
      color: var(--core-light);
    }

    .badge-support {
      background: var(--support-bg);
      border: 1px solid var(--support-border);
      color: var(--support-light);
    }

    .badge-outcome {
      background: var(--outcome-bg);
      border: 1px solid var(--outcome-border);
      color: var(--outcome-light);
    }

    .badge-methodology {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid rgba(139, 92, 246, 0.3);
      color: #a78bfa;
    }

    .details-section {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 14px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .section-label {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
      margin-bottom: 8px;
    }

    .section-text {
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    .chips-container {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      font-size: 0.7rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--bg-primary);
      border: 1px solid rgba(255,255,255,0.08);
      color: var(--text-secondary);
      transition: all var(--transition-fast);
    }

    .chip:hover {
      border-color: rgba(255,255,255,0.2);
      background: var(--bg-hover);
    }

    .chip-core {
      border-color: var(--core-border);
      color: var(--core-light);
    }

    .chip-support {
      border-color: var(--support-border);
      color: var(--support-light);
    }

    .chip-outcome {
      border-color: var(--outcome-border);
      color: var(--outcome-light);
    }

    .chip-ref {
      border-color: var(--accent-purple);
      color: #c4b5fd;
      font-style: italic;
    }

    /* Referências clicáveis */
    a.chip-ref {
      text-decoration: none;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    a.chip-ref:hover {
      background: rgba(139, 92, 246, 0.2);
      border-color: #a78bfa;
      color: #e9d5ff;
      transform: translateY(-1px);
    }

    a.chip-ref::after {
      content: " ↗";
      font-size: 0.7em;
      opacity: 0.7;
    }

    .chip-methodology {
      border-color: rgba(139, 92, 246, 0.3);
      color: #a78bfa;
    }

    /* Proposições */
    .propositions-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .propositions-list {
      flex: 1;
      overflow-y: auto;
      padding-right: 4px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .propositions-list::-webkit-scrollbar {
      width: 4px;
    }

    .propositions-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .propositions-list::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.1);
      border-radius: 2px;
    }

    .proposition-item {
      display: flex;
      align-items: flex-start;
      gap: 10px;
      padding: 10px 12px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
      border: 1px solid transparent;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .proposition-item:hover {
      background: var(--bg-hover);
      border-color: rgba(255,255,255,0.1);
    }

    .proposition-item.active {
      border-color: var(--outcome-primary);
      background: var(--outcome-bg);
    }

    .proposition-code {
      font-size: 0.7rem;
      font-weight: 700;
      color: var(--outcome-light);
      background: rgba(245, 158, 11, 0.15);
      padding: 2px 6px;
      border-radius: 4px;
      flex-shrink: 0;
    }

    .proposition-text {
      font-size: 0.8rem;
      line-height: 1.4;
      color: var(--text-secondary);
    }

    /* ═══════════════════════════════════════════
       QUESTÕES DE INVESTIGAÇÃO
    ═══════════════════════════════════════════ */
    .qi-panel {
      background: var(--bg-card);
      border-radius: var(--radius-lg);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 24px;
    }

    .qi-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }

    .qi-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 20px;
      border-left: 3px solid var(--accent-cyan);
      transition: all var(--transition-fast);
    }

    .qi-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .qi-card h4 {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent-cyan);
      margin-bottom: 10px;
    }

    .qi-card p {
      font-size: 0.9rem;
      line-height: 1.6;
      color: var(--text-secondary);
    }

    /* ═══════════════════════════════════════════
       PROPOSIÇÕES TEÓRICAS TAB
    ═══════════════════════════════════════════ */
    .propositions-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
      margin-bottom: 30px;
    }

    .prop-block {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .prop-block-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
    }

    .prop-block-header.core { border-bottom-color: var(--core-primary); }
    .prop-block-header.support { border-bottom-color: var(--support-primary); }

    .prop-block-icon {
      font-size: 1.3rem;
    }

    .prop-block-header h3 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .prop-card {
      background: var(--bg-card);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid rgba(255,255,255,0.04);
      transition: all var(--transition-fast);
    }

    .prop-card:last-child {
      margin-bottom: 0;
    }

    .prop-card:hover {
      border-color: rgba(139, 92, 246, 0.3);
      transform: translateX(4px);
    }

    .prop-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .prop-code {
      background: linear-gradient(135deg, var(--accent-purple), #7c3aed);
      color: white;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 4px 10px;
      border-radius: var(--radius-sm);
    }

    .prop-relation {
      font-size: 0.75rem;
      font-family: 'SF Mono', 'Consolas', monospace;
      color: var(--text-muted);
      background: rgba(255,255,255,0.05);
      padding: 3px 8px;
      border-radius: var(--radius-sm);
    }

    .prop-text {
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .prop-text strong {
      color: var(--text-primary);
    }

    .prop-evidence {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .prop-tag {
      font-size: 0.65rem;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(139, 92, 246, 0.15);
      color: #c4b5fd;
      border: 1px solid rgba(139, 92, 246, 0.2);
    }

    /* Diagrama de relações */
    .prop-diagram-section {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: 24px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .section-subtitle {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 16px;
    }

    .prop-relations-visual {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .prop-rel-row {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 10px 16px;
      background: var(--bg-card);
      border-radius: var(--radius-md);
    }

    .prop-rel-node {
      font-size: 0.8rem;
      font-weight: 700;
      padding: 6px 14px;
      border-radius: var(--radius-sm);
      min-width: 50px;
      text-align: center;
    }

    .prop-rel-node.core {
      background: var(--core-bg);
      color: var(--core-light);
      border: 1px solid var(--core-border);
    }

    .prop-rel-node.support {
      background: var(--support-bg);
      color: var(--support-light);
      border: 1px solid var(--support-border);
    }

    .prop-rel-arrows {
      display: flex;
      flex-direction: column;
      gap: 4px;
      flex: 1;
    }

    .prop-arrow {
      font-size: 0.7rem;
      color: var(--text-muted);
      font-family: 'SF Mono', 'Consolas', monospace;
    }

    .prop-rel-targets {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .prop-target {
      font-size: 0.7rem;
      font-weight: 600;
      padding: 4px 10px;
      border-radius: var(--radius-sm);
      text-align: center;
    }

    .prop-target.core {
      background: var(--core-bg);
      color: var(--core-light);
      border: 1px solid var(--core-border);
    }

    .prop-target.support {
      background: var(--support-bg);
      color: var(--support-light);
      border: 1px solid var(--support-border);
    }

    .prop-target.outcome {
      background: var(--outcome-bg);
      color: var(--outcome-light);
      border: 1px solid var(--outcome-border);
    }

    /* ═══════════════════════════════════════════
       METODOLOGIA PANEL
    ═══════════════════════════════════════════ */
    .methodology-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    .method-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.04);
      transition: all var(--transition-fast);
    }

    .method-card:hover {
      border-color: rgba(139, 92, 246, 0.3);
      transform: translateY(-2px);
    }

    .method-card .method-icon {
      font-size: 1.5rem;
      margin-bottom: 12px;
    }

    .method-card h4 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    .method-card p {
      font-size: 0.8rem;
      line-height: 1.5;
      color: var(--text-secondary);
      margin-bottom: 12px;
    }

    .method-card ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .method-card li {
      font-size: 0.75rem;
      color: var(--text-muted);
      padding: 4px 0;
      padding-left: 16px;
      position: relative;
    }

    .method-card li::before {
      content: '→';
      position: absolute;
      left: 0;
      color: var(--accent-purple);
    }

    /* ═══════════════════════════════════════════
       ESTUDO COMPARADO
    ═══════════════════════════════════════════ */
    .cities-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
    }

    .city-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 20px;
      border: 1px solid rgba(255,255,255,0.04);
      text-align: center;
      transition: all var(--transition-fast);
    }

    .city-card:hover {
      border-color: var(--support-border);
      transform: translateY(-2px);
    }

    .city-card.porto {
      border-color: var(--outcome-border);
      background: var(--outcome-bg);
    }

    .city-flag {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .city-card h4 {
      font-size: 1rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 4px;
    }

    .city-card .city-country {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .city-card .city-focus {
      font-size: 0.8rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    /* ═══════════════════════════════════════════
       PRÓXIMOS PASSOS
    ═══════════════════════════════════════════ */
    .steps-timeline {
      position: relative;
      padding-left: 30px;
    }

    .steps-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 0;
      bottom: 0;
      width: 2px;
      background: linear-gradient(180deg, var(--core-primary), var(--support-primary), var(--outcome-primary));
      border-radius: 1px;
    }

    .step-item {
      position: relative;
      padding: 16px 20px;
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      margin-bottom: 16px;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .step-item::before {
      content: '';
      position: absolute;
      left: -24px;
      top: 20px;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--bg-card);
      border: 2px solid var(--core-primary);
    }

    .step-item:nth-child(2)::before { border-color: var(--support-primary); }
    .step-item:nth-child(3)::before { border-color: var(--accent-purple); }
    .step-item:nth-child(4)::before { border-color: var(--outcome-primary); }

    .step-item h4 {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .step-item p {
      font-size: 0.85rem;
      color: var(--text-secondary);
      line-height: 1.5;
    }

    .step-item .step-tasks {
      margin-top: 10px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    /* ═══════════════════════════════════════════
       STATISTICS ROW
    ═══════════════════════════════════════════ */
    .stats-row {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-bottom: 14px;
    }

    .stat-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 10px 6px;
      text-align: center;
      border: 1px solid rgba(255,255,255,0.04);
    }

    .stat-value {
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .stat-value.core { color: var(--core-light); }
    .stat-value.support { color: var(--support-light); }
    .stat-value.outcome { color: var(--outcome-light); }
    .stat-value.total { color: var(--text-primary); }
    .stat-value.methodology { color: #a78bfa; }

    .stat-label {
      font-size: 0.55rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    /* ═══════════════════════════════════════════
       FULLSCREEN & SHORTCUTS
    ═══════════════════════════════════════════ */
    
    /* Esconder elementos desnecessários quando em fullscreen */
    body.fullscreen-mode header .header-text,
    body.fullscreen-mode .nav-tabs,
    body.fullscreen-mode footer {
      display: none !important;
    }

    body.fullscreen-mode {
      overflow: hidden;
    }

    body.fullscreen-mode header {
      position: fixed;
      top: 0;
      right: 0;
      left: auto;
      z-index: 10001;
      background: transparent;
      padding: 15px 20px;
    }

    body.fullscreen-mode header .header-content {
      justify-content: flex-end;
    }

    body.fullscreen-mode .header-actions {
      background: rgba(15, 23, 42, 0.9);
      padding: 10px 15px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
    }

    body.fullscreen-mode main {
      padding: 0;
    }

    /* Fullscreen para a tab do modelo */
    body.fullscreen-mode #tab-modelo {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
      background: var(--bg-primary);
      padding: 20px;
      padding-top: 70px;
      overflow: auto;
      display: grid;
      grid-template-columns: 1fr 380px;
      gap: 20px;
    }

    body.fullscreen-mode #tab-modelo .diagram-panel {
      height: calc(100vh - 100px);
      overflow: auto;
    }

    body.fullscreen-mode #tab-modelo .details-panel {
      height: calc(100vh - 100px);
      overflow: auto;
    }

    body.fullscreen-mode #tab-modelo .diagram-canvas {
      min-height: calc(100vh - 200px);
    }

    /* Fullscreen para outras tabs */
    body.fullscreen-mode #tab-questoes,
    body.fullscreen-mode #tab-proposicoes,
    body.fullscreen-mode #tab-metodologia,
    body.fullscreen-mode #tab-comparado,
    body.fullscreen-mode #tab-passos {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 9999;
      background: var(--bg-primary);
      padding: 80px 40px 40px 40px;
      overflow: auto;
    }

    .shortcuts-hint {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: var(--bg-card);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 12px 16px;
      font-size: 0.7rem;
      color: var(--text-muted);
      z-index: 100;
      opacity: 0;
      transform: translateY(10px);
      transition: all var(--transition-normal);
      pointer-events: none;
    }

    .shortcuts-hint.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .shortcuts-hint kbd {
      background: var(--bg-secondary);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 4px;
      padding: 2px 6px;
      margin-right: 4px;
      font-family: monospace;
      color: var(--text-secondary);
    }

    /* ═══════════════════════════════════════════
       TOUR MODE
    ═══════════════════════════════════════════ */
    .tour-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.85);
      z-index: 1000;
      display: none;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity var(--transition-slow);
    }

    .tour-overlay.active {
      display: flex;
      opacity: 1;
    }

    .tour-card {
      background: var(--bg-card);
      border-radius: var(--radius-xl);
      border: 1px solid rgba(255,255,255,0.1);
      padding: 32px 40px;
      max-width: 560px;
      text-align: center;
      position: relative;
      box-shadow: var(--shadow-lg);
      animation: tourSlideIn 0.4s ease;
    }

    @keyframes tourSlideIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .tour-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: none;
      background: rgba(255,255,255,0.05);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition-fast);
    }

    .tour-close:hover {
      background: rgba(255,255,255,0.1);
      color: var(--text-primary);
    }

    .tour-step-indicator {
      display: flex;
      justify-content: center;
      gap: 6px;
      margin-bottom: 24px;
    }

    .tour-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(255,255,255,0.15);
      transition: all var(--transition-fast);
    }

    .tour-dot.active {
      background: var(--outcome-primary);
      box-shadow: 0 0 8px var(--outcome-primary);
    }

    .tour-dot.completed {
      background: var(--core-primary);
    }

    .tour-icon {
      width: 64px;
      height: 64px;
      margin: 0 auto 20px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
    }

    .tour-icon.core { background: var(--core-bg); border: 2px solid var(--core-border); }
    .tour-icon.support { background: var(--support-bg); border: 2px solid var(--support-border); }
    .tour-icon.outcome { background: var(--outcome-bg); border: 2px solid var(--outcome-border); }

    .tour-title {
      font-family: 'Playfair Display', serif;
      font-size: 1.4rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .tour-code {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .tour-description {
      font-size: 0.95rem;
      line-height: 1.7;
      color: var(--text-secondary);
      margin-bottom: 24px;
    }

    .tour-nav {
      display: flex;
      justify-content: space-between;
      gap: 12px;
    }

    .tour-nav .btn {
      flex: 1;
    }

    /* ═══════════════════════════════════════════
       TOAST NOTIFICATIONS
    ═══════════════════════════════════════════ */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 2000;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      background: var(--bg-card);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: var(--radius-md);
      padding: 12px 16px;
      font-size: 0.85rem;
      color: var(--text-primary);
      box-shadow: var(--shadow-lg);
      animation: toastSlideIn 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    @keyframes toastSlideIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .toast.success { border-left: 3px solid var(--core-primary); }
    .toast.info { border-left: 3px solid var(--support-primary); }
    .toast.warning { border-left: 3px solid var(--outcome-primary); }

    /* ═══════════════════════════════════════════
       FOOTER
    ═══════════════════════════════════════════ */
    footer {
      position: relative;
      z-index: 1;
      padding: 16px 32px;
      border-top: 1px solid rgba(255,255,255,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .footer-text {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .footer-text strong {
      color: var(--text-secondary);
    }

    /* ═══════════════════════════════════════════
       MOBILE RESPONSIVE - Android & iOS
       Otimizado para ecrãs pequenos
    ═══════════════════════════════════════════ */
    @media (max-width: 768px) {
      /* HEADER - Mais compacto */
      header {
        padding: 12px 16px !important;
      }
      
      .header-content {
        flex-direction: column !important;
        gap: 12px;
        align-items: flex-start !important;
      }
      
      .header-text h1 {
        font-size: 1.2rem !important;
        line-height: 1.3;
      }
      
      .header-text p {
        font-size: 0.75rem !important;
        line-height: 1.4;
      }
      
      .header-actions {
        width: 100%;
        justify-content: flex-start;
        gap: 8px;
      }
      
      .btn {
        padding: 8px 12px;
        font-size: 0.75rem;
        min-height: 32px;
        flex: 1;
        min-width: 0;
        justify-content: center;
      }
      
      .btn svg {
        width: 14px;
        height: 14px;
      }

      /* TABS - Scroll horizontal melhorado */
      .nav-tabs {
        padding: 0 16px;
        gap: 2px;
      }
      
      .nav-tab {
        padding: 10px 14px;
        font-size: 0.75rem;
        flex-shrink: 0;
      }

      /* MAIN LAYOUT - Coluna única em mobile */
      main {
        padding: 12px 16px 20px !important;
        display: flex !important;
        flex-direction: column !important;
        gap: 16px;
      }
      
      .tab-content.active {
        display: flex !important;
        flex-direction: column !important;
        gap: 16px;
      }

      /* DIAGRAM PANEL - Adaptado para mobile */
      .diagram-panel {
        padding: 16px;
        border-radius: var(--radius-md);
      }
      
      .panel-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 12px;
      }
      
      .panel-title {
        font-size: 1rem;
      }
      
      .legend {
        gap: 10px;
      }
      
      .legend-item {
        font-size: 0.7rem;
      }

      .diagram-canvas {
        min-height: 380px;
      }
      
      .nodes-container {
        padding: 5px 0;
      }
      
      .node-row {
        gap: 8px;
        margin-bottom: 12px;
      }
      
      .node {
        min-width: 130px !important;
        max-width: 140px !important;
        padding: 10px 12px;
        margin: 0;
      }
      
      .node-outcome {
        min-width: 160px !important;
        max-width: 180px !important;
      }
      
      .node-code {
        font-size: 0.65rem;
      }
      
      .node-title {
        font-size: 0.75rem;
        margin-bottom: 4px;
      }
      
      .node-tag {
        font-size: 0.6rem;
        padding: 3px 8px;
        line-height: 1.2;
      }

      /* DETAILS PANEL - Em baixo em mobile */
      .details-panel {
        max-height: none;
        padding: 16px;
        border-radius: var(--radius-md);
      }
      
      .stats-row {
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 6px;
        margin-bottom: 12px;
      }
      
      .stat-card {
        padding: 8px 4px;
      }
      
      .stat-value {
        font-size: 1.1rem;
      }
      
      .stat-label {
        font-size: 0.5rem;
      }
      
      .details-title {
        font-size: 1rem;
      }
      
      .details-section {
        padding: 12px;
      }
      
      .section-text {
        font-size: 0.8rem;
        line-height: 1.5;
      }
      
      .chip {
        font-size: 0.65rem;
        padding: 3px 8px;
      }
      
      .propositions-list {
        max-height: 200px;
      }

      /* QUESTÕES DE INVESTIGAÇÃO - Grid 1 coluna */
      .qi-panel {
        padding: 16px;
      }
      
      .qi-grid {
        grid-template-columns: 1fr !important;
        gap: 12px;
      }
      
      .qi-card {
        padding: 16px;
      }
      
      .qi-card h4 {
        font-size: 0.7rem;
      }
      
      .qi-card p {
        font-size: 0.8rem;
      }

      /* PROPOSIÇÕES TEÓRICAS - Grid 1 coluna */
      .propositions-grid {
        grid-template-columns: 1fr !important;
        gap: 16px;
      }
      
      .prop-card {
        padding: 14px;
      }
      
      .prop-text {
        font-size: 0.8rem;
      }
      
      .prop-rel-row {
        flex-direction: column;
        gap: 8px;
        padding: 12px;
      }
      
      .prop-rel-arrows {
        flex-direction: row;
        justify-content: center;
      }

      /* METODOLOGIA - Grid 1 coluna */
      .methodology-grid {
        grid-template-columns: 1fr !important;
        gap: 12px;
      }
      
      .method-card {
        padding: 16px;
      }

      /* CIDADES - Grid 1 coluna */
      .cities-grid {
        grid-template-columns: 1fr !important;
        gap: 12px;
      }
      
      .city-card {
        padding: 16px;
      }

      /* PRÓXIMOS PASSOS */
      .steps-timeline {
        padding-left: 20px;
      }
      
      .step-item {
        padding: 14px;
        margin-bottom: 12px;
      }
      
      .step-item::before {
        left: -16px;
        width: 10px;
        height: 10px;
      }

      /* TOUR - Mais compacto */
      .tour-card {
        margin: 16px;
        padding: 24px 20px;
      }
      
      .tour-title {
        font-size: 1.2rem;
      }
      
      .tour-description {
        font-size: 0.85rem;
      }

      /* TOAST - Em baixo no centro */
      .toast-container {
        bottom: 16px;
        right: 16px;
        left: 16px;
      }
      
      .toast {
        padding: 10px 14px;
        font-size: 0.8rem;
      }

      /* SHORTCUTS - Escondido em mobile */
      .shortcuts-hint {
        display: none;
      }

      /* FOOTER - Mais compacto */
      footer {
        padding: 12px 16px;
      }
      
      .footer-text {
        font-size: 0.7rem;
        text-align: center;
        width: 100%;
      }
    }

    /* ═══════════════════════════════════════════
       VERY SMALL SCREENS (iPhone SE, pequenos Android)
    ═══════════════════════════════════════════ */
    @media (max-width: 375px) {
      .header-text h1 {
        font-size: 1.1rem !important;
      }
      
      .btn {
        padding: 6px 8px;
        font-size: 0.7rem;
        min-height: 30px;
      }
      
      .nav-tab {
        padding: 8px 10px;
        font-size: 0.7rem;
      }
      
      .node {
        min-width: 120px !important;
        max-width: 130px !important;
        padding: 8px 10px;
      }
      
      .node-outcome {
        min-width: 140px !important;
        max-width: 150px !important;
      }
      
      .node-title {
        font-size: 0.7rem;
      }
      
      .node-tag {
        font-size: 0.55rem;
        padding: 2px 6px;
      }
      
      .stat-value {
        font-size: 1rem;
      }
    }

    /* ═══════════════════════════════════════════
       LANDSCAPE ORIENTATION
    ═══════════════════════════════════════════ */
    @media (max-height: 600px) and (orientation: landscape) {
      .diagram-canvas {
        min-height: 280px;
      }
      
      .nodes-container {
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
      }
      
      .node-row {
        flex-direction: column;
        gap: 8px;
        margin-bottom: 0;
        margin-right: 12px;
      }
      
      .node {
        min-width: 140px !important;
        max-width: 150px !important;
      }
      
      .details-panel {
        max-height: 280px;
      }
      
      .propositions-list {
        max-height: 120px;
      }
    }

    /* ═══════════════════════════════════════════
       RESPONSIVE (Tablets e ecrãs médios)
    ═══════════════════════════════════════════ */
    @media (max-width: 1200px) {
      .tab-content.active {
        grid-template-columns: 1fr;
      }

      .details-panel {
        max-height: none;
      }

      .stats-row {
        grid-template-columns: repeat(3, 1fr);
      }

      .methodology-grid {
        grid-template-columns: 1fr;
      }

      .propositions-grid {
        grid-template-columns: 1fr;
      }

      .cities-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* ═══════════════════════════════════════════
       ANIMATIONS
    ═══════════════════════════════════════════ */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .animate-fade-in {
      animation: fadeInUp 0.4s ease forwards;
    }

    .node {
      opacity: 0;
      animation: fadeInUp 0.5s ease forwards;
    }

    /* Garantir que TODOS os nós ficam SEMPRE visíveis em hover e active */
    .node:hover,
    .node.active {
      opacity: 1 !important;
      visibility: visible !important;
    }

    .node:nth-child(1) { animation-delay: 0.1s; }
    .node:nth-child(2) { animation-delay: 0.2s; }
    .node:nth-child(3) { animation-delay: 0.3s; }

    /* ═══════════════════════════════════════════
       PRINT STYLES - Projeto Completo
    ═══════════════════════════════════════════ */
    @media print {
      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
        color-adjust: exact !important;
      }

      body {
        background: white !important;
        color: #1a1a1a !important;
        font-size: 11pt !important;
        line-height: 1.4 !important;
      }

      body::before {
        display: none !important;
      }

      /* Esconder elementos de interface */
      .header-actions, .nav-tabs, .tour-overlay, 
      .toast-container, .shortcuts-hint, .btn,
      .node-tooltip {
        display: none !important;
      }

      /* Header simplificado */
      header {
        background: white !important;
        border-bottom: 2px solid #1f3b57 !important;
        padding: 15px 20px !important;
        page-break-after: avoid;
      }

      .header-text h1 {
        font-size: 18pt !important;
        color: #1f3b57 !important;
        background: none !important;
        -webkit-text-fill-color: #1f3b57 !important;
        margin-bottom: 5px !important;
      }

      .header-text p {
        color: #333 !important;
        font-size: 10pt !important;
      }

      .header-text .orientador {
        color: #555 !important;
        font-size: 9pt !important;
      }

      .header-text .orientador strong {
        color: #1f3b57 !important;
      }

      /* Layout principal */
      main {
        display: block !important;
        padding: 10px 20px !important;
        max-width: 100% !important;
      }

      /* Mostrar TODAS as tabs */
      .tab-content {
        display: block !important;
        page-break-inside: avoid;
        margin-bottom: 20px !important;
        border: 1px solid #ddd !important;
        border-radius: 8px !important;
        padding: 15px !important;
        background: white !important;
      }

      .tab-content::before {
        display: none !important;
      }

      /* Títulos de secção para impressão */
      .print-section-title {
        display: block !important;
        font-size: 14pt !important;
        font-weight: bold !important;
        color: #1f3b57 !important;
        border-bottom: 2px solid #1f3b57 !important;
        padding-bottom: 5px !important;
        margin-bottom: 15px !important;
      }

      /* Painéis */
      .diagram-panel, .details-panel, .qi-panel {
        background: white !important;
        border: 1px solid #ccc !important;
        box-shadow: none !important;
        page-break-inside: avoid;
        margin-bottom: 15px !important;
      }

      .panel-title, .panel-header h2 {
        color: #1f3b57 !important;
        font-size: 12pt !important;
      }

      /* Nós do diagrama */
      .node {
        opacity: 1 !important;
        animation: none !important;
        background: white !important;
        border: 2px solid #333 !important;
        color: #1a1a1a !important;
        box-shadow: none !important;
      }

      .node-core { 
        border-color: #10b981 !important; 
        background: #f0fdf4 !important;
      }
      .node-support { 
        border-color: #3b82f6 !important; 
        background: #eff6ff !important;
      }
      .node-outcome { 
        border-color: #f59e0b !important; 
        background: #fffbeb !important;
        animation: none !important;
      }

      .node-title {
        color: #1a1a1a !important;
        font-size: 9pt !important;
      }

      .node-code {
        color: #333 !important;
      }

      .node-tag {
        background: #f3f4f6 !important;
        color: #374151 !important;
        font-size: 7pt !important;
        border: 1px solid #d1d5db !important;
      }

      .node-core .node-tag {
        background: #d1fae5 !important;
        border-color: #10b981 !important;
        color: #065f46 !important;
      }

      .node-support .node-tag {
        background: #dbeafe !important;
        border-color: #3b82f6 !important;
        color: #1e40af !important;
      }

      .node-outcome .node-tag,
      .tag-outcome {
        background: #fef3c7 !important;
        border-color: #f59e0b !important;
        color: #78350f !important;
        font-weight: 600 !important;
      }

      /* Esconder conexões SVG - são calculadas dinamicamente e não funcionam bem em impressão */
      .diagram-svg {
        display: none !important;
      }

      /* Indicadores de fluxo alternativos para impressão */
      .nodes-container {
        position: relative !important;
      }

      .node-row {
        position: relative !important;
        margin-bottom: 30px !important;
      }

      /* Setas de fluxo entre rows */
      .node-row:not(.outcome-row)::after {
        content: "▼" !important;
        display: block !important;
        text-align: center !important;
        font-size: 18pt !important;
        color: #9ca3af !important;
        margin-top: 12px !important;
        letter-spacing: 0.5em !important;
      }

      .node-row:first-child::after {
        content: "▼  ▼  ▼" !important;
        color: #10b981 !important;
      }

      .node-row:nth-child(2)::after {
        content: "▼  ▼  ▼" !important;
        color: #f59e0b !important;
      }

      .outcome-row {
        margin-top: 10px !important;
      }

      /* Legenda */
      .legend {
        margin-top: 10px !important;
      }

      .legend-item {
        color: #333 !important;
        font-size: 8pt !important;
      }

      /* Stats */
      .stats-row {
        display: grid !important;
        grid-template-columns: repeat(5, 1fr) !important;
        gap: 8px !important;
      }

      .stat-card {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        padding: 8px !important;
      }

      .stat-value {
        font-size: 14pt !important;
      }

      .stat-value.core { color: #10b981 !important; }
      .stat-value.support { color: #3b82f6 !important; }
      .stat-value.outcome { color: #f59e0b !important; }
      .stat-value.total, .stat-value.methodology { color: #1f3b57 !important; }

      .stat-label {
        color: #6b7280 !important;
        font-size: 7pt !important;
      }

      /* Detalhes */
      .details-section {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        margin-bottom: 10px !important;
        padding: 10px !important;
      }

      .section-label {
        color: #374151 !important;
        font-size: 8pt !important;
      }

      .section-text {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      /* Chips */
      .chip {
        background: #f3f4f6 !important;
        border: 1px solid #d1d5db !important;
        color: #374151 !important;
        font-size: 8pt !important;
        padding: 2px 6px !important;
      }

      .chip-core { border-color: #10b981 !important; color: #047857 !important; }
      .chip-support { border-color: #3b82f6 !important; color: #1d4ed8 !important; }
      .chip-outcome { border-color: #f59e0b !important; color: #b45309 !important; }
      .chip-methodology { border-color: #8b5cf6 !important; color: #6d28d9 !important; }
      .chip-ref { border-color: #8b5cf6 !important; color: #6d28d9 !important; font-style: italic !important; }

      /* Proposições */
      .proposition-item {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        margin-bottom: 5px !important;
        padding: 8px !important;
        page-break-inside: avoid;
      }

      .proposition-code {
        background: #fef3c7 !important;
        color: #92400e !important;
        font-size: 8pt !important;
      }

      .proposition-text {
        color: #1f2937 !important;
        font-size: 9pt !important;
      }

      /* Questões de Investigação */
      .qi-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
      }

      .qi-card {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        border-left: 3px solid #06b6d4 !important;
        padding: 10px !important;
        page-break-inside: avoid;
      }

      .qi-card h4 {
        color: #0891b2 !important;
        font-size: 9pt !important;
      }

      .qi-card p {
        color: #1f2937 !important;
        font-size: 9pt !important;
      }

      /* Proposições Teóricas */
      .propositions-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 15px !important;
      }

      .prop-block {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        padding: 12px !important;
        page-break-inside: avoid;
      }

      .prop-block-header {
        border-bottom-color: #d1d5db !important;
      }

      .prop-block-header h3 {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      .prop-card {
        background: #ffffff !important;
        border: 1px solid #e5e7eb !important;
        padding: 10px !important;
      }

      .prop-code {
        background: #8b5cf6 !important;
        color: white !important;
        font-size: 8pt !important;
      }

      .prop-relation {
        color: #6b7280 !important;
        font-size: 8pt !important;
      }

      .prop-text {
        color: #374151 !important;
        font-size: 9pt !important;
      }

      .prop-text strong {
        color: #1f2937 !important;
      }

      .prop-tag {
        background: #f3e8ff !important;
        color: #6d28d9 !important;
        border-color: #c4b5fd !important;
        font-size: 7pt !important;
      }

      .prop-diagram-section {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        padding: 12px !important;
      }

      .section-subtitle {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      .prop-rel-row {
        background: #ffffff !important;
        border: 1px solid #e5e7eb !important;
      }

      .prop-rel-node, .prop-target {
        border: 1px solid #d1d5db !important;
      }

      .prop-rel-node.core, .prop-target.core {
        background: #dcfce7 !important;
        color: #166534 !important;
      }

      .prop-rel-node.support, .prop-target.support {
        background: #dbeafe !important;
        color: #1e40af !important;
      }

      .prop-target.outcome {
        background: #fef3c7 !important;
        color: #92400e !important;
      }

      .prop-arrow {
        color: #6b7280 !important;
      }

      /* Metodologia */
      .methodology-grid {
        display: grid !important;
        grid-template-columns: repeat(2, 1fr) !important;
        gap: 10px !important;
      }

      .method-card {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        padding: 10px !important;
        page-break-inside: avoid;
      }

      .method-card .method-icon {
        font-size: 16pt !important;
      }

      .method-card h4 {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      .method-card p {
        color: #4b5563 !important;
        font-size: 9pt !important;
      }

      .method-card li {
        color: #6b7280 !important;
        font-size: 8pt !important;
      }

      .method-card li::before {
        color: #8b5cf6 !important;
      }

      /* Cidades */
      .cities-grid {
        display: grid !important;
        grid-template-columns: repeat(3, 1fr) !important;
        gap: 10px !important;
      }

      .city-card {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        padding: 10px !important;
        page-break-inside: avoid;
      }

      .city-card.porto {
        background: #fffbeb !important;
        border-color: #f59e0b !important;
      }

      .city-flag {
        font-size: 20pt !important;
      }

      .city-card h4 {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      .city-card .city-country {
        color: #6b7280 !important;
        font-size: 8pt !important;
      }

      .city-card .city-focus {
        color: #4b5563 !important;
        font-size: 8pt !important;
      }

      /* Timeline */
      .steps-timeline {
        padding-left: 25px !important;
      }

      .steps-timeline::before {
        background: linear-gradient(180deg, #10b981, #3b82f6, #8b5cf6, #f59e0b) !important;
      }

      .step-item {
        background: #f9fafb !important;
        border: 1px solid #e5e7eb !important;
        margin-bottom: 10px !important;
        padding: 10px !important;
        page-break-inside: avoid;
      }

      .step-item::before {
        background: white !important;
        border-width: 2px !important;
      }

      .step-item h4 {
        color: #1f2937 !important;
        font-size: 10pt !important;
      }

      .step-item p {
        color: #4b5563 !important;
        font-size: 9pt !important;
      }

      /* Footer */
      footer {
        background: white !important;
        border-top: 1px solid #e5e7eb !important;
        padding: 10px 20px !important;
        page-break-before: avoid;
      }

      .footer-text {
        color: #6b7280 !important;
        font-size: 8pt !important;
        text-align: center !important;
      }

      .footer-text strong {
        color: #1f3b57 !important;
      }

      /* Page breaks */
      .page-break {
        page-break-before: always !important;
      }

      /* Esconder scrollbars */
      .propositions-list, .details-panel {
        max-height: none !important;
        overflow: visible !important;
      }
    }
  </style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="header-text">
      <h1>Modelo Conceptual – Reposicionamento Premium do Porto</h1>
      <p>Turistificação massiva, políticas públicas, IA e marketing sensorial na hotelaria de luxo como instrumentos de reposicionamento do destino.</p>
      <p class="orientador">Programa de Doutoramento en Marketing Político, Actores e Institucións nas Sociedades Contemporáneas · <strong>Doutorando: Pedro Oliveira</strong> · Orientador: Prof. Ramón Bouzas Lorenzo · USC · 2025</p>
    </div>
    <div class="header-actions">
      <button class="btn" id="btn-tour" title="Modo Apresentação (T)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Tour
      </button>
      <button class="btn" id="btn-fullscreen" title="Ecrã Inteiro (F)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
        Fullscreen
      </button>
      <button class="btn" id="btn-animate" title="Animar Fluxos (A)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        Animar
      </button>
      <button class="btn" id="btn-reset" title="Repor Vista (R)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
        Repor
      </button>
      <button class="btn btn-primary" id="btn-export" title="Exportar Projeto PDF (E)">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
        Exportar PDF
      </button>
    </div>
  </div>
</header>

<!-- Tabs de navegação -->
<nav class="nav-tabs">
  <button class="nav-tab active" data-tab="modelo">Modelo Conceptual</button>
  <button class="nav-tab" data-tab="questoes">Questões de Investigação</button>
  <button class="nav-tab" data-tab="proposicoes">Proposições Teóricas</button>
  <button class="nav-tab" data-tab="metodologia">Metodologia</button>
  <button class="nav-tab" data-tab="comparado">Experiências Internacionais</button>
  <button class="nav-tab" data-tab="passos">Próximos Passos</button>
</nav>

<main>
  <!-- TAB: Modelo Conceptual -->
  <div class="tab-content active" id="tab-modelo">
    <!-- Painel do Diagrama -->
    <section class="diagram-panel" id="diagram-panel">
      <div class="panel-header">
        <h2 class="panel-title">Mapa de Variáveis Latentes</h2>
        <div class="legend">
          <div class="legend-item">
            <span class="legend-dot core"></span>
            <span>Núcleo Institucional</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot support"></span>
            <span>Vetores de Suporte</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot outcome"></span>
            <span>Resultado</span>
          </div>
        </div>
      </div>

      <div class="diagram-canvas" id="diagram-canvas">
        <svg class="diagram-svg" id="connections-svg">
          <defs>
            <marker id="arrow-core" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L9,3 z" fill="var(--core-primary)" class="arrow-head"/>
            </marker>
            <marker id="arrow-support" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L9,3 z" fill="var(--support-primary)" class="arrow-head"/>
            </marker>
            <marker id="arrow-outcome" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
              <path d="M0,0 L0,6 L9,3 z" fill="var(--outcome-primary)" class="arrow-head"/>
            </marker>
          </defs>
        </svg>

        <div class="nodes-container">
          <div class="node-row">
            <div class="node node-core" data-node="PP">
              <div class="node-code">PP</div>
              <div class="node-title">Políticas Públicas de Turismo</div>
              <span class="node-tag">Regulação · Ordenamento · Sustentabilidade</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
            <div class="node node-core" data-node="GU">
              <div class="node-code">GU</div>
              <div class="node-title">Governação Urbana</div>
              <span class="node-tag">Município · Região · Setor Privado</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
            <div class="node node-core" data-node="MT">
              <div class="node-code">MT</div>
              <div class="node-title">Marketing Territorial</div>
              <span class="node-tag">Marca Porto · Posicionamento Premium</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
          </div>

          <div class="node-row">
            <div class="node node-support" data-node="HL">
              <div class="node-code">HL</div>
              <div class="node-title">Hotelaria de Luxo</div>
              <span class="node-tag">Oferta Premium · Gasto por Visitante</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
            <div class="node node-support" data-node="MS">
              <div class="node-code">MS</div>
              <div class="node-title">Marketing Sensorial</div>
              <span class="node-tag">Ambiente · Som · Aromas · Luz</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
            <div class="node node-support" data-node="IA">
              <div class="node-code">IA</div>
              <div class="node-title">Inteligência Artificial</div>
              <span class="node-tag">Dados · Personalização · Fluxos</span>
              <div class="node-tooltip">Clique para ver detalhes</div>
            </div>
          </div>

          <div class="node-row outcome-row">
            <div class="node node-outcome" data-node="RPP">
              <div class="node-code">RPP</div>
              <div class="node-title">Reposicionamento Premium do Porto</div>
              <span class="node-tag tag-outcome" style="background: #78350f; border: 1px solid #fbbf24; color: #ffffff; font-weight: 600;">Turismo de Valor · Sem Aumentar Volume</span>
              <div class="node-tooltip">Resultado final do modelo</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Painel de Detalhes -->
    <section class="details-panel">
      <div class="stats-row">
        <div class="stat-card">
          <div class="stat-value core">3</div>
          <div class="stat-label">Núcleo</div>
        </div>
        <div class="stat-card">
          <div class="stat-value support">3</div>
          <div class="stat-label">Suporte</div>
        </div>
        <div class="stat-card">
          <div class="stat-value outcome">1</div>
          <div class="stat-label">Resultado</div>
        </div>
        <div class="stat-card">
          <div class="stat-value total">8</div>
          <div class="stat-label">Proposições</div>
        </div>
        <div class="stat-card">
          <div class="stat-value methodology">4</div>
          <div class="stat-label">Métodos</div>
        </div>
      </div>

      <div class="details-header">
        <h2 class="details-title" id="detail-title">Seleciona uma variável</h2>
        <span class="details-badge badge-core" id="detail-badge">Modelo Conceptual</span>
      </div>

      <div class="details-section">
        <div class="section-label">Descrição</div>
        <p class="section-text" id="detail-description">
          Clica em qualquer variável do diagrama para explorar a sua definição, fontes de evidência, proposições teóricas associadas e revistas-alvo para publicação.
        </p>
      </div>

      <div class="details-section">
        <div class="section-label">Fontes de Evidência</div>
        <div class="chips-container" id="detail-sources">
          <span class="chip chip-methodology">Análise documental</span>
          <span class="chip chip-methodology">Entrevistas</span>
          <span class="chip chip-methodology">Estudo de caso</span>
        </div>
      </div>

      <div class="details-section">
        <div class="section-label">Revistas-alvo Sugeridas</div>
        <div class="chips-container" id="detail-journals">
          <span class="chip chip-support">Tourism Management</span>
          <span class="chip chip-support">Journal of Sustainable Tourism</span>
          <span class="chip chip-support">Cities</span>
        </div>
      </div>

      <div class="details-section">
        <div class="section-label">Referências-chave</div>
        <div class="chips-container" id="detail-references">
          <span class="chip chip-ref">Seleciona uma variável</span>
        </div>
      </div>

      <div class="propositions-section">
        <div class="section-label" style="margin-bottom: 10px;">Proposições Teóricas (P1-P8)</div>
        <div class="propositions-list" id="propositions-list">
          <!-- Preenchido via JavaScript -->
        </div>
      </div>
    </section>
  </div>

  <!-- TAB: Questões de Investigação -->
  <div class="tab-content" id="tab-questoes">
    <div class="qi-panel" style="grid-column: 1 / -1;">
      <div class="panel-header">
        <h2 class="panel-title">Questões de Investigação</h2>
      </div>
      <p class="section-text" style="margin-bottom: 8px;">
        As questões de investigação orientam a exploração qualitativa do fenómeno, permitindo uma compreensão aprofundada das relações entre variáveis através de análise documental, entrevistas e estudo de caso.
      </p>
      
      <div class="qi-grid">
        <div class="qi-card">
          <h4>QI1 – Políticas e Resultados</h4>
          <p>Como influíram as políticas turísticas do Porto na captação e no perfil dos visitantes?</p>
        </div>
        <div class="qi-card">
          <h4>QI2 – Políticas e Governação</h4>
          <p>Que políticas públicas e modelos de governação (município–região–setor privado) podem facilitar a reorientação do Porto para um turismo de maior valor acrescentado?</p>
        </div>
        <div class="qi-card">
          <h4>QI3 – Marketing Sensorial</h4>
          <p>Como pode o marketing sensorial na hotelaria de luxo contribuir para elevar o gasto por visitante e reforçar o posicionamento premium do destino?</p>
        </div>
        <div class="qi-card">
          <h4>QI4 – Inteligência Artificial</h4>
          <p>De que modo as ferramentas de IA podem apoiar a gestão de dados turísticos, a personalização de experiências premium e a redução de externalidades negativas?</p>
        </div>
        <div class="qi-card">
          <h4>QI5 – Experiências Internacionais</h4>
          <p>Que orientações podem ser extraídas das experiências de outras cidades europeias (Amesterdão, Santiago de Compostela, Veneza) para informar as políticas de reposicionamento do Porto?</p>
        </div>
        <div class="qi-card">
          <h4>QI6 – Modelo Integrado</h4>
          <p>Como podem as políticas públicas, o marketing territorial, a IA e o marketing sensorial articular-se num modelo integrado de reposicionamento premium do Porto?</p>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB: Proposições Teóricas -->
  <div class="tab-content" id="tab-proposicoes">
    <div class="qi-panel" style="grid-column: 1 / -1;">
      <div class="panel-header">
        <h2 class="panel-title">Proposições Teóricas (P1-P8)</h2>
      </div>
      <p class="section-text" style="margin-bottom: 20px;">
        Em vez de hipóteses quantitativas testáveis estatisticamente, a abordagem qualitativa utiliza <strong>proposições teóricas</strong> que orientam a investigação e serão exploradas através de análise documental, entrevistas e estudo de caso.
      </p>

      <div class="propositions-grid">
        <!-- Bloco: Núcleo Institucional → Vetores -->
        <div class="prop-block">
          <div class="prop-block-header core">
            <span class="prop-block-icon">🏛️</span>
            <h3>Núcleo Institucional → Sistema</h3>
          </div>
          
          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P1</span>
              <span class="prop-relation">PP → HL</span>
            </div>
            <p class="prop-text">As <strong>políticas públicas de turismo</strong> influenciam positivamente o desenvolvimento e a qualidade da <strong>hotelaria de luxo</strong> através de incentivos, regulamentação favorável e ordenamento territorial adequado.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Análise documental</span>
              <span class="prop-tag">Entrevistas</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P2</span>
              <span class="prop-relation">PP → RPP</span>
            </div>
            <p class="prop-text">A existência de <strong>políticas públicas</strong> orientadas para o turismo de valor favorece o <strong>reposicionamento premium</strong> do destino através da regulação do alojamento local e promoção de segmentos de alto valor.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Análise documental</span>
              <span class="prop-tag">Experiências internacionais</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P3</span>
              <span class="prop-relation">GU → PP</span>
            </div>
            <p class="prop-text">Uma <strong>governação urbana</strong> sólida e de qualidade influencia positivamente a formulação e implementação das <strong>políticas públicas de turismo</strong>.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Entrevistas</span>
              <span class="prop-tag">Análise institucional</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P4</span>
              <span class="prop-relation">GU → RPP</span>
            </div>
            <p class="prop-text">A qualidade da <strong>governação urbana</strong> (coordenação, fiscalização, implementação) determina positiva ou negativamente o sucesso do <strong>reposicionamento premium</strong>.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Entrevistas</span>
              <span class="prop-tag">Estudo de caso</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P5</span>
              <span class="prop-relation">MT → RPP</span>
            </div>
            <p class="prop-text">As orientações de <strong>marketing territorial</strong> e <strong>place branding</strong> determinam positivamente a perceção do Porto como <strong>destino premium</strong>, incluindo a forma como os estabelecimentos comunicam a experiência sensorial.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Análise documental</span>
              <span class="prop-tag">Entrevistas</span>
            </div>
          </div>
        </div>

        <!-- Bloco: Vetores de Suporte → Resultado -->
        <div class="prop-block">
          <div class="prop-block-header support">
            <span class="prop-block-icon">🎯</span>
            <h3>Vetores de Suporte → Resultado</h3>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P6</span>
              <span class="prop-relation">HL → RPP</span>
            </div>
            <p class="prop-text">A qualidade da oferta de <strong>hotelaria de luxo</strong> determina positivamente o <strong>posicionamento premium</strong> do destino, elevando o gasto médio por visitante e atraindo segmentos de alto valor.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Estudo de caso</span>
              <span class="prop-tag">Dados RevPAR</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P7</span>
              <span class="prop-relation">MS → RPP</span>
            </div>
            <p class="prop-text">O <strong>marketing sensorial</strong> (ambiente, som, aromas, luz) reforça a perceção de autenticidade e valor premium, contribuindo para o reposicionamento. Verificável através de inquéritos a turistas.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Observação</span>
              <span class="prop-tag">Inquéritos a clientes</span>
            </div>
          </div>

          <div class="prop-card">
            <div class="prop-header">
              <span class="prop-code">P8</span>
              <span class="prop-relation">IA → RPP</span>
            </div>
            <p class="prop-text">A <strong>inteligência artificial</strong> otimiza a gestão de fluxos, personaliza experiências e reduz externalidades negativas, apoiando o <strong>reposicionamento premium</strong>. Verificável através de entrevistas técnicas e grupos focais.</p>
            <div class="prop-evidence">
              <span class="prop-tag">Análise de sistemas</span>
              <span class="prop-tag">Entrevistas técnicas</span>
              <span class="prop-tag">Grupos focais</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Diagrama visual das relações -->
      <div class="prop-diagram-section">
        <h3 class="section-subtitle">Mapa de Relações</h3>
        <div class="prop-relations-visual">
          <div class="prop-rel-row">
            <div class="prop-rel-node core">PP</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P1 →</span>
              <span class="prop-arrow">→ P2 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target support">HL</span>
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
          <div class="prop-rel-row">
            <div class="prop-rel-node core">GU</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P3 →</span>
              <span class="prop-arrow">→ P4 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target core">PP</span>
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
          <div class="prop-rel-row">
            <div class="prop-rel-node core">MT</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P5 →</span>
              <span class="prop-arrow">→ P6 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target support">MS</span>
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
          <div class="prop-rel-row">
            <div class="prop-rel-node support">HL</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P7 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
          <div class="prop-rel-row">
            <div class="prop-rel-node support">MS</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P8 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
          <div class="prop-rel-row">
            <div class="prop-rel-node support">IA</div>
            <div class="prop-rel-arrows">
              <span class="prop-arrow">→ P9 →</span>
            </div>
            <div class="prop-rel-targets">
              <span class="prop-target outcome">RPP</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB: Metodologia -->
  <div class="tab-content" id="tab-metodologia">
    <div class="qi-panel" style="grid-column: 1 / -1;">
      <div class="panel-header">
        <h2 class="panel-title">Metodologia Qualitativa</h2>
      </div>
      <p class="section-text" style="margin-bottom: 20px;">
        A investigação segue uma abordagem <strong>qualitativa e documental</strong>, conforme orientação do Prof. Ramón Bouzas Lorenzo, articulando quatro componentes metodológicos complementares.
      </p>

      <div class="methodology-grid">
        <div class="method-card">
          <div class="method-icon">📄</div>
          <h4>1. Análise Documental</h4>
          <p>Revisão sistemática de documentos oficiais e dados estatísticos sobre turismo no Porto.</p>
          <ul>
            <li>Regulamentos municipais e regionais</li>
            <li>Plano Estratégico da Cidade</li>
            <li>Planos de Marketing Territorial</li>
            <li>Planos de Sustentabilidade</li>
            <li>Relatórios de impacto turístico</li>
            <li>Dados sobre fluxos, alojamento e gasto</li>
          </ul>
        </div>

        <div class="method-card">
          <div class="method-icon">🌍</div>
          <h4>2. Referências Contextuais</h4>
          <p>Análise de experiências de outras cidades europeias como contexto informativo (não como estudo comparado formal).</p>
          <ul>
            <li>Políticas em Amesterdão e Santiago de Compostela</li>
            <li>Orientações e boas práticas</li>
            <li>Lições para o contexto do Porto</li>
            <li>Experiências de gestão de fluxos</li>
            <li>Estratégias de preservação patrimonial</li>
          </ul>
        </div>

        <div class="method-card">
          <div class="method-icon">🎙️</div>
          <h4>3. Entrevistas em Profundidade</h4>
          <p>Recolha de perspetivas de múltiplos stakeholders do ecossistema turístico.</p>
          <ul>
            <li>Responsáveis políticos e técnicos de turismo</li>
            <li>Cidadãos e residentes afetados</li>
            <li>Empresas hoteleiras (foco: luxo)</li>
            <li>Representantes do setor cultural</li>
            <li>Especialistas em IA e marketing</li>
          </ul>
        </div>

        <div class="method-card">
          <div class="method-icon">🏨</div>
          <h4>4. Estudo de Caso</h4>
          <p>Análise aprofundada de práticas em hotéis de luxo.</p>
          <ul>
            <li>Vários hotéis de luxo no Porto</li>
            <li>Eventualmente hotéis noutras cidades</li>
            <li>Práticas de marketing sensorial</li>
            <li>Uso de IA no relacionamento com hóspedes</li>
            <li>Estratégias de posicionamento premium</li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB: Experiências Internacionais -->
  <div class="tab-content" id="tab-comparado">
    <div class="qi-panel" style="grid-column: 1 / -1;">
      <div class="panel-header">
        <h2 class="panel-title">Experiências Internacionais – Referências Contextuais</h2>
      </div>
      <p class="section-text" style="margin-bottom: 20px;">
        A análise centra-se exclusivamente no Porto. As experiências de outras cidades europeias servem como <strong>referências contextuais</strong> para identificar orientações, práticas e lições que possam informar as políticas de reposicionamento – sem constituir um estudo comparado formal.
      </p>

      <div class="cities-grid">
        <div class="city-card porto">
          <div class="city-flag">🇵🇹</div>
          <h4>Porto</h4>
          <div class="city-country">Portugal (Caso de Estudo)</div>
          <div class="city-focus">
            Saturação do centro histórico, predominância de turismo low-cost, pressão sobre residentes e necessidade de reposicionamento premium.
          </div>
        </div>

        <div class="city-card">
          <div class="city-flag">🇳🇱</div>
          <h4>Amesterdão</h4>
          <div class="city-country">Países Baixos</div>
          <div class="city-focus">
            Políticas de "destination management", taxas turísticas elevadas, limitação de alojamento local e campanhas de dissuasão de turismo de massas.
          </div>
        </div>

        <div class="city-card">
          <div class="city-flag">🇪🇸</div>
          <h4>Santiago de Compostela</h4>
          <div class="city-country">Espanha (Galiza)</div>
          <div class="city-focus">
            Gestão de fluxos do Caminho de Santiago, pressão sobre centro histórico UNESCO, políticas de preservação patrimonial e equilíbrio entre peregrinos/turistas e residentes.
          </div>
        </div>

        <div class="city-card">
          <div class="city-flag">🇮🇹</div>
          <h4>Veneza</h4>
          <div class="city-country">Itália</div>
          <div class="city-focus">
            Taxa de entrada para visitantes diários, limitação de grupos turísticos e políticas de preservação do património e comunidade local.
          </div>
        </div>

        <div class="city-card">
          <div class="city-flag">🇭🇷</div>
          <h4>Dubrovnik</h4>
          <div class="city-country">Croácia</div>
          <div class="city-focus">
            Limitação do número de visitantes diários na cidade antiga, gestão de cruzeiros e monitorização em tempo real de fluxos turísticos.
          </div>
        </div>

        <div class="city-card">
          <div class="city-flag">🇦🇹</div>
          <h4>Viena</h4>
          <div class="city-country">Áustria</div>
          <div class="city-focus">
            Modelo de sucesso em turismo cultural de alto valor, estratégia de marketing premium e equilíbrio entre visitantes e qualidade de vida.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- TAB: Próximos Passos -->
  <div class="tab-content" id="tab-passos">
    <div class="qi-panel" style="grid-column: 1 / -1;">
      <div class="panel-header">
        <h2 class="panel-title">Próximos Passos – Roadmap da Tese</h2>
      </div>
      <p class="section-text" style="margin-bottom: 20px;">
        Conforme as orientações do Prof. Ramón Bouzas Lorenzo, as prioridades imediatas para o desenvolvimento da investigação são:
      </p>

      <div class="steps-timeline">
        <div class="step-item">
          <h4>1. Justificar o Problema</h4>
          <p>Reunir dados e evidência empírica que documentem a turistificação massiva do Porto: saturação do centro histórico, deslocamento de residentes, predominância de turismo low-cost e tensões de sustentabilidade.</p>
          <div class="step-tasks">
            <span class="chip chip-core">Dados INE/Turismo de Portugal</span>
            <span class="chip chip-core">Relatórios CM Porto</span>
            <span class="chip chip-core">Estudos de impacto</span>
          </div>
        </div>

        <div class="step-item">
          <h4>2. Revisão de Literatura</h4>
          <p>Realizar um estudo aprofundado da literatura sobre três eixos principais:</p>
          <div class="step-tasks">
            <span class="chip chip-support">Reorientação de políticas para turismo de alto valor</span>
            <span class="chip chip-support">Marketing sensorial no turismo de luxo</span>
            <span class="chip chip-support">Uso de IA em marketing turístico</span>
          </div>
        </div>

        <div class="step-item">
          <h4>3. Estrutura da Tese</h4>
          <p>Definir uma primeira proposta estruturada de capítulos ou, em alternativa, um esquema de tese por artigos coerente com os eixos da investigação.</p>
          <div class="step-tasks">
            <span class="chip chip-methodology">Tese monográfica vs. por artigos</span>
            <span class="chip chip-methodology">Índice preliminar</span>
            <span class="chip chip-methodology">Cronograma</span>
          </div>
        </div>

        .step-item {
          <h4>4. Preparar Reunião de Orientação</h4>
          <p>Apresentar ao Prof. Ramón Bouzas materiais preparados para discussão e validação:</p>
          <div class="step-tasks">
            <span class="chip chip-outcome">Justificação empírica do problema</span>
            <span class="chip chip-outcome">Mapa preliminar da literatura</span>
            <span class="chip chip-outcome">Esboço de estrutura</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<footer>
  <div class="footer-text">
    <strong>Programa de Doutoramento en Marketing Político, Actores e Institucións nas Sociedades Contemporáneas</strong><br>
    Universidad de Santiago de Compostela · 2025 · Doutorando: Pedro Oliveira · Orientador: Prof. Ramón Bouzas Lorenzo
  </div>
</footer>

<!-- Tour Overlay -->
<div class="tour-overlay" id="tour-overlay">
  <div class="tour-card">
    <button class="tour-close" id="tour-close">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
      </svg>
    </button>
    <div class="tour-step-indicator" id="tour-indicators"></div>
    <div class="tour-icon" id="tour-icon">🏛️</div>
    <h3 class="tour-title" id="tour-title">Bem-vindo ao Modelo</h3>
    <div class="tour-code" id="tour-code">Introdução</div>
    <p class="tour-description" id="tour-description">
      Este dashboard apresenta o modelo conceptual da tese de doutoramento sobre o reposicionamento premium do Porto.
    </p>
    <div class="tour-nav">
      <button class="btn" id="tour-prev">← Anterior</button>
      <button class="btn btn-primary" id="tour-next">Seguinte →</button>
    </div>
  </div>
</div>

<!-- Toast Container -->
<div class="toast-container" id="toast-container"></div>

<!-- Keyboard Shortcuts Hint -->
<div class="shortcuts-hint" id="shortcuts-hint">
  <kbd>1</kbd>-<kbd>7</kbd> Variáveis &nbsp;|&nbsp;
  <kbd>T</kbd> Tour &nbsp;|&nbsp;
  <kbd>F</kbd> Fullscreen &nbsp;|&nbsp;
  <kbd>A</kbd> Animar &nbsp;|&nbsp;
  <kbd>R</kbd> Repor &nbsp;|&nbsp;
  <kbd>E</kbd> Exportar PDF &nbsp;|&nbsp;
  <kbd>?</kbd> Ajuda
</div>

<script>
  // ═══════════════════════════════════════════════════════════════════════════
  // DADOS DO MODELO CONCEPTUAL
  // ═══════════════════════════════════════════════════════════════════════════
  const nodes = {
    "PP": {
      code: "PP",
      titulo: "Políticas Públicas de Turismo",
      tipo: "core",
      icon: "🏛️",
      descricao: "Inclui medidas de regulação do alojamento local, ordenamento do território, gestão da mobilidade e políticas para mitigar a turistificação e promover sustentabilidade urbana. Enquadramento legal e institucional que orienta o desenvolvimento turístico.",
      fontes: ["Regulamentos municipais", "Planos estratégicos", "Relatórios de impacto", "Dados estatísticos oficiais"],
      revistas: ["Cities", "Journal of Urban Affairs", "Journal of Sustainable Tourism", "Urban Policy and Research"],
      referencias: [
        { texto: "Colomb & Novy (2016)", url: "https://scholar.google.com/scholar?q=Colomb+Novy+2016+protest+resistance+tourism" },
        { texto: "Cocola-Gant (2018)", url: "https://scholar.google.com/scholar?q=Cocola-Gant+2018+tourism+gentrification" },
        { texto: "Gotham (2005)", url: "https://scholar.google.com/scholar?q=Gotham+2005+tourism+gentrification+New+Orleans" },
        { texto: "Sequera & Nofre (2018)", url: "https://scholar.google.com/scholar?q=Sequera+Nofre+2018+touristification+nightlife" }
      ]
    },
    "GU": {
      code: "GU",
      titulo: "Governação Urbana",
      tipo: "core",
      icon: "⚖️",
      descricao: "Coordenação entre municípios, região de turismo, residentes e setor privado. Capacidade de decisão, fiscalização e implementação de políticas. Modelo multinível conforme orientação do Prof. Bouzas.",
      fontes: ["Entrevistas a responsáveis políticos", "Documentos de governação", "Análise institucional"],
      revistas: ["Cities", "Urban Studies", "Urban Governance", "Journal of Urban Management"],
      referencias: [
        { texto: "Pierre (2014)", url: "https://scholar.google.com/scholar?q=Jon+Pierre+2014+urban+governance" },
        { texto: "Stoker (1998)", url: "https://scholar.google.com/scholar?q=Stoker+1998+governance+theory" },
        { texto: "Rhodes (1996)", url: "https://scholar.google.com/scholar?q=Rhodes+1996+new+governance" },
        { texto: "Healey (2006)", url: "https://scholar.google.com/scholar?q=Patsy+Healey+2006+collaborative+planning" }
      ]
    },
    "MT": {
      code: "MT",
      titulo: "Marketing Territorial / Place Branding",
      tipo: "core",
      icon: "🎯",
      descricao: "Identidade, narrativa e posicionamento do Porto como destino premium. Diferenciação do modelo massificado e low-cost. Estratégia de comunicação do valor diferenciador do destino aos segmentos-alvo de alto poder aquisitivo.",
      fontes: ["Planos de marketing da cidade", "Campanhas de promoção", "Estratégias de marca"],
      revistas: ["Place Branding and Public Diplomacy", "Journal of Destination Marketing & Management", "Journal of Place Management and Development"],
      referencias: [
        { texto: "Kavaratzis & Ashworth (2005)", url: "https://scholar.google.com/scholar?q=Kavaratzis+Ashworth+2005+city+branding" },
        { texto: "Anholt (2007)", url: "https://scholar.google.com/scholar?q=Simon+Anholt+2007+competitive+identity" },
        { texto: "Govers & Go (2009)", url: "https://scholar.google.com/scholar?q=Govers+Go+2009+place+branding" },
        { texto: "Zenker & Braun (2017)", url: "https://scholar.google.com/scholar?q=Zenker+Braun+2017+place+brand+management" }
      ]
    },
    "HL": {
      code: "HL",
      titulo: "Hotelaria de Luxo",
      tipo: "support",
      icon: "🏨",
      descricao: "Oferta hoteleira de luxo como âncora para o posicionamento premium. Eleva o padrão de experiência e aumenta a receita por visitante. Atrai turistas com maior poder de compra e menor impacto negativo na qualidade de vida local.",
      fontes: ["Estudo de caso em hotéis", "Entrevistas a gestores hoteleiros", "Dados de ocupação e RevPAR"],
      revistas: ["International Journal of Hospitality Management", "International Journal of Contemporary Hospitality Management", "Cornell Hospitality Quarterly"],
      referencias: [
        { texto: "Walls et al. (2011)", url: "https://scholar.google.com/scholar?q=Walls+2011+luxury+hotel+experience" },
        { texto: "Yang et al. (2012)", url: "https://scholar.google.com/scholar?q=Yang+2012+luxury+hotel+brand+equity" },
        { texto: "Cetin & Dincer (2014)", url: "https://scholar.google.com/scholar?q=Cetin+Dincer+2014+hotel+experience" },
        { texto: "Ahn & Back (2018)", url: "https://scholar.google.com/scholar?q=Ahn+Back+2018+luxury+hotel+antecedents" }
      ]
    },
    "MS": {
      code: "MS",
      titulo: "Marketing Sensorial",
      tipo: "support",
      icon: "✨",
      descricao: "Estímulos sensoriais (som, luz, cheiro, toque, sabor) que geram emoções positivas, sensação de autenticidade e perceção de valor premium. Instrumento de reforço do posicionamento que eleva o gasto por visitante.",
      fontes: ["Observação em hotéis de luxo", "Entrevistas a especialistas", "Análise de práticas sensoriais"],
      revistas: ["IJHM", "IJCHM", "Journal of Hospitality & Tourism Research", "Tourism Management"],
      referencias: [
        { texto: "Krishna (2012)", url: "https://scholar.google.com/scholar?q=Aradhna+Krishna+2012+sensory+marketing" },
        { texto: "Spence et al. (2014)", url: "https://scholar.google.com/scholar?q=Spence+2014+store+atmospherics+sensory" },
        { texto: "Agapito et al. (2017)", url: "https://scholar.google.com/scholar?q=Agapito+2017+sensory+tourism+experiences" },
        { texto: "Lv et al. (2022)", url: "https://scholar.google.com/scholar?q=Lv+2022+sensory+marketing+hospitality" }
      ]
    },
    "IA": {
      code: "IA",
      titulo: "Inteligência Artificial",
      tipo: "support",
      icon: "🤖",
      descricao: "Sistemas de previsão de fluxos turísticos, gestão de dados, segmentação de turistas premium, personalização de experiências e apoio à tomada de decisão. Enabler transversal que reduz externalidades negativas.",
      fontes: ["Análise de sistemas em uso", "Entrevistas a técnicos", "Casos de aplicação"],
      revistas: ["Journal of Hospitality & Tourism Technology", "Tourism Management Perspectives", "Computers in Human Behavior"],
      referencias: [
        { texto: "Tussyadiah (2020)", url: "https://scholar.google.com/scholar?q=Tussyadiah+2020+AI+hospitality+tourism" },
        { texto: "Gretzel et al. (2015)", url: "https://scholar.google.com/scholar?q=Gretzel+2015+smart+tourism" },
        { texto: "Buhalis & Sinarta (2019)", url: "https://scholar.google.com/scholar?q=Buhalis+Sinarta+2019+real+time+cocreation" },
        { texto: "Li et al. (2021)", url: "https://scholar.google.com/scholar?q=Li+2021+AI+tourism+research" }
      ]
    },
    "RPP": {
      code: "RPP",
      titulo: "Reposicionamento Premium do Porto",
      tipo: "outcome",
      icon: "🏆",
      descricao: "Resultado do modelo: cidade menos dependente de volume low-cost, mais orientada para valor, sustentabilidade e qualidade de vida dos residentes. Equilibra atração de visitantes, uso da cidade e geração de valor económico.",
      fontes: ["Síntese de todas as fontes", "Indicadores de sucesso", "Benchmarking internacional"],
      revistas: ["Tourism Management", "Journal of Sustainable Tourism", "Annals of Tourism Research", "Journal of Travel Research"],
      referencias: [
        { texto: "Pike (2012)", url: "https://scholar.google.com/scholar?q=Pike+2012+destination+marketing" },
        { texto: "Dwyer & Kim (2003)", url: "https://scholar.google.com/scholar?q=Dwyer+Kim+2003+destination+competitiveness" },
        { texto: "Buhalis (2000)", url: "https://scholar.google.com/scholar?q=Buhalis+2000+marketing+competitive+destination" },
        { texto: "Ritchie & Crouch (2003)", url: "https://scholar.google.com/scholar?q=Ritchie+Crouch+2003+competitive+destination" }
      ]
    }
  };

  // PROPOSIÇÕES TEÓRICAS (em vez de Hipóteses)
  const propositions = [
    { code: "P1", texto: "As políticas públicas de turismo influenciam positivamente o desenvolvimento e qualidade da hotelaria de luxo.", from: "PP", to: "HL" },
    { code: "P2", texto: "A existência de políticas públicas orientadas para turismo de valor favorece o reposicionamento premium do destino.", from: "PP", to: "RPP" },
    { code: "P3", texto: "Uma governação urbana sólida e de qualidade influencia positivamente a formulação de políticas de turismo.", from: "GU", to: "PP" },
    { code: "P4", texto: "A qualidade da governação urbana determina (positiva ou negativamente) o sucesso do reposicionamento premium.", from: "GU", to: "RPP" },
    { code: "P5", texto: "As orientações de marketing territorial e place branding determinam a perceção do Porto como destino premium.", from: "MT", to: "RPP" },
    { code: "P6", texto: "A qualidade da oferta de hotelaria de luxo determina positivamente o posicionamento premium do destino.", from: "HL", to: "RPP" },
    { code: "P7", texto: "O marketing sensorial reforça a perceção de autenticidade e valor premium. Verificável com inquéritos a turistas.", from: "MS", to: "RPP" },
    { code: "P8", texto: "A IA otimiza fluxos e personaliza experiências, apoiando o reposicionamento. Verificável com entrevistas técnicas e grupos focais.", from: "IA", to: "RPP" }
  ];

  // Conexões para o diagrama SVG
  const connections = [
    { from: "PP", to: "HL", type: "core", proposition: "P1" },
    { from: "PP", to: "RPP", type: "outcome", proposition: "P2" },
    { from: "GU", to: "PP", type: "core", proposition: "P3" },
    { from: "GU", to: "RPP", type: "outcome", proposition: "P4" },
    { from: "MT", to: "RPP", type: "outcome", proposition: "P5" },
    { from: "HL", to: "RPP", type: "outcome", proposition: "P6" },
    { from: "MS", to: "RPP", type: "outcome", proposition: "P7" },
    { from: "IA", to: "RPP", type: "outcome", proposition: "P8" }
  ];

  // Tour steps
  const tourSteps = [
    {
      title: "Bem-vindo ao Modelo Conceptual",
      code: "Introdução",
      icon: "📊",
      iconClass: "",
      description: "Este dashboard apresenta o modelo conceptual da tese de doutoramento sobre o reposicionamento premium do Porto. O modelo integra políticas públicas, governação, marketing territorial, hotelaria de luxo, marketing sensorial e IA, seguindo uma metodologia qualitativa."
    },
    ...Object.values(nodes).map(node => ({
      title: node.titulo,
      code: node.code,
      icon: node.icon,
      iconClass: node.tipo,
      description: node.descricao,
      nodeKey: node.code
    })),
    {
      title: "Proposições Teóricas",
      code: "8 Proposições",
      icon: "🔗",
      iconClass: "",
      description: "O modelo articula 8 proposições teóricas que serão exploradas através de metodologia qualitativa: análise documental, referências contextuais internacionais (Amesterdão, Santiago de Compostela), entrevistas em profundidade e estudo de caso em hotéis de luxo."
    }
  ];

  // ═══════════════════════════════════════════════════════════════════════════
  // DOM ELEMENTS
  // ═══════════════════════════════════════════════════════════════════════════
  const detailTitle = document.getElementById("detail-title");
  const detailBadge = document.getElementById("detail-badge");
  const detailDescription = document.getElementById("detail-description");
  const detailSources = document.getElementById("detail-sources");
  const detailJournals = document.getElementById("detail-journals");
  const detailReferences = document.getElementById("detail-references");
  const propositionsList = document.getElementById("propositions-list");
  const connectionsSvg = document.getElementById("connections-svg");
  const diagramCanvas = document.getElementById("diagram-canvas");
  const diagramPanel = document.getElementById("diagram-panel");
  const tourOverlay = document.getElementById("tour-overlay");
  const toastContainer = document.getElementById("toast-container");
  const shortcutsHint = document.getElementById("shortcuts-hint");

  // Estado da aplicação
  let isAnimating = false;
  let isFullscreen = false;
  const nodeKeys = ["PP", "GU", "MT", "HL", "MS", "IA", "RPP"];

  // ═══════════════════════════════════════════════════════════════════════════
  // UTILITY FUNCTIONS
  // ═══════════════════════════════════════════════════════════════════════════
  function showToast(message, type = "info") {
    const toast = document.createElement("div");
    toast.className = `toast ${type}`;
    toast.innerHTML = message;
    toastContainer.appendChild(toast);
    setTimeout(() => {
      toast.style.opacity = "0";
      toast.style.transform = "translateX(100%)";
      setTimeout(() => toast.remove(), 300);
    }, 3000);
  }

  function clearActiveStates() {
    document.querySelectorAll(".node").forEach(n => n.classList.remove("active"));
    document.querySelectorAll(".proposition-item").forEach(h => h.classList.remove("active"));
    document.querySelectorAll(".diagram-svg path").forEach(p => p.classList.remove("highlighted"));
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // TABS NAVIGATION
  // ═══════════════════════════════════════════════════════════════════════════
  document.querySelectorAll(".nav-tab").forEach(tab => {
    tab.addEventListener("click", () => {
      document.querySelectorAll(".nav-tab").forEach(t => t.classList.remove("active"));
      tab.classList.add("active");
      
      const targetId = `tab-${tab.dataset.tab}`;
      document.querySelectorAll(".tab-content").forEach(content => {
        content.classList.remove("active");
        if (content.id === targetId) {
          content.classList.add("active");
        }
      });

      // Redesenhar conexões se voltar ao modelo
      if (tab.dataset.tab === "modelo") {
        setTimeout(drawConnections, 100);
      }
    });
  });

  // ═══════════════════════════════════════════════════════════════════════════
  // SVG CONNECTION DRAWING
  // ═══════════════════════════════════════════════════════════════════════════
  function getNodeCenter(nodeKey) {
    const nodeEl = document.querySelector(`.node[data-node="${nodeKey}"]`);
    if (!nodeEl) return null;
    
    const canvasRect = diagramCanvas.getBoundingClientRect();
    const nodeRect = nodeEl.getBoundingClientRect();
    
    return {
      x: nodeRect.left - canvasRect.left + nodeRect.width / 2,
      y: nodeRect.top - canvasRect.top + nodeRect.height / 2,
      top: nodeRect.top - canvasRect.top,
      bottom: nodeRect.top - canvasRect.top + nodeRect.height,
      left: nodeRect.left - canvasRect.left,
      right: nodeRect.left - canvasRect.left + nodeRect.width
    };
  }

  function drawConnections() {
    const existingPaths = connectionsSvg.querySelectorAll("path.connection");
    existingPaths.forEach(p => p.remove());

    connections.forEach(conn => {
      const fromPos = getNodeCenter(conn.from);
      const toPos = getNodeCenter(conn.to);
      
      if (!fromPos || !toPos) return;

      let startX, startY, endX, endY;
      
      if (toPos.top > fromPos.bottom - 10) {
        startX = fromPos.x;
        startY = fromPos.bottom;
        endX = toPos.x;
        endY = toPos.top;
      } else if (toPos.left > fromPos.right - 10) {
        startX = fromPos.right;
        startY = fromPos.y;
        endX = toPos.left;
        endY = toPos.y;
      } else if (toPos.right < fromPos.left + 10) {
        startX = fromPos.left;
        startY = fromPos.y;
        endX = toPos.right;
        endY = toPos.y;
      } else {
        startX = fromPos.x;
        startY = fromPos.bottom;
        endX = toPos.x;
        endY = toPos.top;
      }

      const controlOffset = Math.abs(endY - startY) * 0.3;
      
      let pathD;
      if (Math.abs(endX - startX) < 20 && endY > startY) {
        pathD = `M ${startX} ${startY} L ${endX} ${endY - 10}`;
      } else {
        pathD = `M ${startX} ${startY} 
                 C ${startX} ${startY + controlOffset}, 
                   ${endX} ${endY - controlOffset}, 
                   ${endX} ${endY - 10}`;
      }

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", pathD);
      path.setAttribute("class", `connection ${conn.type}-path${isAnimating ? ' animated' : ''}`);
      path.setAttribute("data-from", conn.from);
      path.setAttribute("data-to", conn.to);
      path.setAttribute("data-proposition", conn.proposition);
      path.setAttribute("marker-end", `url(#arrow-${conn.type})`);
      
      connectionsSvg.appendChild(path);
    });
  }

  function highlightConnections(fromNodes, toNode) {
    document.querySelectorAll(".diagram-svg path.connection").forEach(path => {
      const pathFrom = path.getAttribute("data-from");
      const pathTo = path.getAttribute("data-to");
      
      const fromArray = fromNodes.split(",").map(f => f.trim());
      
      if (fromArray.includes(pathFrom) && pathTo === toNode) {
        path.classList.add("highlighted");
      } else {
        path.classList.remove("highlighted");
      }
    });
  }

  function highlightNodeConnections(nodeKey) {
    document.querySelectorAll(".diagram-svg path.connection").forEach(path => {
      const pathFrom = path.getAttribute("data-from");
      const pathTo = path.getAttribute("data-to");
      
      if (pathFrom === nodeKey || pathTo === nodeKey) {
        path.classList.add("highlighted");
      } else {
        path.classList.remove("highlighted");
      }
    });
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // RENDER FUNCTIONS
  // ═══════════════════════════════════════════════════════════════════════════
  function renderNodeDetails(key) {
    const node = nodes[key];
    if (!node) return;
    
    clearActiveStates();
    
    const activeNode = document.querySelector(`.node[data-node="${key}"]`);
    if (activeNode) activeNode.classList.add("active");
    
    highlightNodeConnections(key);

    detailTitle.textContent = `${node.titulo} (${node.code})`;
    
    let badgeText = "Núcleo Institucional";
    let badgeClass = "badge-core";
    if (node.tipo === "support") {
      badgeText = "Vetor de Suporte";
      badgeClass = "badge-support";
    } else if (node.tipo === "outcome") {
      badgeText = "Resultado do Modelo";
      badgeClass = "badge-outcome";
    }
    detailBadge.textContent = badgeText;
    detailBadge.className = `details-badge ${badgeClass}`;

    detailDescription.textContent = node.descricao;

    // Fontes de evidência
    detailSources.innerHTML = "";
    node.fontes.forEach(fonte => {
      const chip = document.createElement("span");
      chip.className = "chip chip-methodology";
      chip.textContent = fonte;
      detailSources.appendChild(chip);
    });

    // Revistas
    detailJournals.innerHTML = "";
    node.revistas.forEach(rev => {
      const chip = document.createElement("span");
      chip.className = "chip chip-support";
      chip.textContent = rev;
      detailJournals.appendChild(chip);
    });

    // Referências com links
    detailReferences.innerHTML = "";
    if (node.referencias && node.referencias.length > 0) {
      node.referencias.forEach(ref => {
        const link = document.createElement("a");
        link.className = "chip chip-ref";
        link.href = ref.url;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = ref.texto;
        link.title = "Abrir no Google Scholar";
        detailReferences.appendChild(link);
      });
    }

    // Highlight related propositions
    propositions.forEach((p, index) => {
      const item = propositionsList.children[index];
      if (item) {
        const fromNodes = p.from.split(",").map(f => f.trim());
        if (fromNodes.includes(key) || p.to === key) {
          item.classList.add("active");
        }
      }
    });
  }

  function renderPropositions() {
    propositionsList.innerHTML = "";
    
    propositions.forEach(p => {
      const item = document.createElement("div");
      item.className = "proposition-item";
      item.dataset.from = p.from;
      item.dataset.to = p.to;

      const code = document.createElement("span");
      code.className = "proposition-code";
      code.textContent = p.code;

      const text = document.createElement("span");
      text.className = "proposition-text";
      text.textContent = p.texto;

      item.appendChild(code);
      item.appendChild(text);

      item.addEventListener("click", () => {
        clearActiveStates();
        item.classList.add("active");

        const fromNodes = p.from.split(",");
        fromNodes.forEach(f => {
          const nodeEl = document.querySelector(`.node[data-node="${f.trim()}"]`);
          if (nodeEl) nodeEl.classList.add("active");
        });

        const toNodeEl = document.querySelector(`.node[data-node="${p.to.trim()}"]`);
        if (toNodeEl) toNodeEl.classList.add("active");

        highlightConnections(p.from, p.to.trim());

        detailTitle.textContent = `Proposição ${p.code}`;
        detailBadge.textContent = "Proposição Teórica";
        detailBadge.className = "details-badge badge-outcome";
        detailDescription.textContent = p.texto;
      });

      propositionsList.appendChild(item);
    });
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // TOUR MODE
  // ═══════════════════════════════════════════════════════════════════════════
  let currentTourStep = 0;

  function renderTourIndicators() {
    const container = document.getElementById("tour-indicators");
    container.innerHTML = "";
    
    tourSteps.forEach((_, index) => {
      const dot = document.createElement("span");
      dot.className = "tour-dot";
      if (index === currentTourStep) dot.classList.add("active");
      if (index < currentTourStep) dot.classList.add("completed");
      container.appendChild(dot);
    });
  }

  function renderTourStep() {
    const step = tourSteps[currentTourStep];
    
    document.getElementById("tour-title").textContent = step.title;
    document.getElementById("tour-code").textContent = step.code;
    document.getElementById("tour-description").textContent = step.description;
    
    const iconEl = document.getElementById("tour-icon");
    iconEl.textContent = step.icon;
    iconEl.className = `tour-icon ${step.iconClass}`;
    
    renderTourIndicators();

    const prevBtn = document.getElementById("tour-prev");
    const nextBtn = document.getElementById("tour-next");
    
    prevBtn.style.visibility = currentTourStep === 0 ? "hidden" : "visible";
    
    if (currentTourStep === tourSteps.length - 1) {
      nextBtn.innerHTML = `Terminar ✓`;
    } else {
      nextBtn.innerHTML = `Seguinte →`;
    }

    if (step.nodeKey) {
      renderNodeDetails(step.nodeKey);
    }
  }

  function startTour() {
    currentTourStep = 0;
    tourOverlay.classList.add("active");
    renderTourStep();
  }

  function closeTour() {
    tourOverlay.classList.remove("active");
  }

  function nextTourStep() {
    if (currentTourStep < tourSteps.length - 1) {
      currentTourStep++;
      renderTourStep();
    } else {
      closeTour();
      showToast("✅ Tour concluído! Explore o modelo livremente.", "success");
    }
  }

  function prevTourStep() {
    if (currentTourStep > 0) {
      currentTourStep--;
      renderTourStep();
    }
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // FULLSCREEN & ANIMATION
  // ═══════════════════════════════════════════════════════════════════════════
  function toggleFullscreen() {
    isFullscreen = !isFullscreen;
    document.body.classList.toggle("fullscreen-mode", isFullscreen);
    setTimeout(drawConnections, 100);
    
    const btn = document.getElementById("btn-fullscreen");
    if (isFullscreen) {
      btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3"/></svg> Sair`;
      showToast("⛶ Modo ecrã inteiro. Prima F ou ESC para sair.", "info");
    } else {
      btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg> Fullscreen`;
    }
  }

  function toggleAnimation() {
    isAnimating = !isAnimating;
    
    document.querySelectorAll(".diagram-svg path.connection").forEach(path => {
      path.classList.toggle("animated", isAnimating);
    });
    
    const btn = document.getElementById("btn-animate");
    if (isAnimating) {
      btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg> Parar`;
      btn.classList.add("btn-primary");
      showToast("▶️ Animação de fluxo ativada", "success");
    } else {
      btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg> Animar`;
      btn.classList.remove("btn-primary");
    }
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // EXPORT PDF - Projeto Completo
  // ═══════════════════════════════════════════════════════════════════════════
  
  function prepareForPrint() {
    // Adicionar títulos de secção para impressão
    const sections = [
      { id: 'tab-modelo', title: '1. Modelo Conceptual' },
      { id: 'tab-questoes', title: '2. Questões de Investigação' },
      { id: 'tab-proposicoes', title: '3. Proposições Teóricas' },
      { id: 'tab-metodologia', title: '4. Metodologia Qualitativa' },
      { id: 'tab-comparado', title: '5. Experiências Internacionais' },
      { id: 'tab-passos', title: '6. Próximos Passos' }
    ];

    sections.forEach(section => {
      const element = document.getElementById(section.id);
      if (element) {
        // Remover título anterior se existir
        const existingTitle = element.querySelector('.print-section-title');
        if (existingTitle) existingTitle.remove();
        
        // Adicionar novo título
        const title = document.createElement('h2');
        title.className = 'print-section-title';
        title.textContent = section.title;
        title.style.display = 'none'; // Escondido por defeito, visível apenas em print
        element.insertBefore(title, element.firstChild);
      }
    });

    // Garantir que todos os nós estão visíveis
    document.querySelectorAll('.node').forEach(node => {
      node.style.opacity = '1';
    });

    // Redesenhar conexões
    drawConnections();
  }

  function exportDiagram() {
    showToast("📄 A preparar PDF do projeto completo...", "info");
    
    // Preparar documento para impressão
    prepareForPrint();
    
    // Pequeno delay para garantir que tudo está renderizado
    setTimeout(() => {
      // Mostrar instruções
      const instructions = document.createElement('div');
      instructions.id = 'print-instructions';
      instructions.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.9);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      `;
      instructions.innerHTML = `
        <div style="background: white; border-radius: 16px; padding: 32px; max-width: 500px; text-align: center; color: #1a1a1a;">
          <div style="font-size: 48px; margin-bottom: 16px;">📄</div>
          <h2 style="font-size: 1.5rem; margin-bottom: 12px; color: #1f3b57;">Exportar Projeto como PDF</h2>
          <p style="color: #666; margin-bottom: 20px; line-height: 1.6;">
            A janela de impressão vai abrir. Para guardar como PDF:
          </p>
          <ol style="text-align: left; color: #333; margin-bottom: 24px; padding-left: 20px; line-height: 1.8;">
            <li>Em <strong>"Destino"</strong> ou <strong>"Impressora"</strong>, escolha <strong>"Guardar como PDF"</strong></li>
            <li>Em <strong>"Páginas"</strong>, selecione <strong>"Todas"</strong></li>
            <li>Clique em <strong>"Guardar"</strong> ou <strong>"Imprimir"</strong></li>
          </ol>
          <div style="display: flex; gap: 12px; justify-content: center;">
            <button id="cancel-print" style="padding: 12px 24px; border-radius: 8px; border: 1px solid #ddd; background: white; color: #666; cursor: pointer; font-size: 0.9rem;">
              Cancelar
            </button>
            <button id="confirm-print" style="padding: 12px 24px; border-radius: 8px; border: none; background: linear-gradient(135deg, #f59e0b, #d97706); color: white; cursor: pointer; font-size: 0.9rem; font-weight: 600;">
              Abrir Impressão
            </button>
          </div>
        </div>
      `;
      document.body.appendChild(instructions);

      // Event listeners para os botões
      document.getElementById('cancel-print').addEventListener('click', () => {
        instructions.remove();
        showToast("❌ Exportação cancelada", "warning");
      });

      document.getElementById('confirm-print').addEventListener('click', () => {
        instructions.remove();
        
        // Abrir janela de impressão
        window.print();
        
        // Feedback após impressão
        setTimeout(() => {
          showToast("✅ Se guardou o PDF, o ficheiro está pronto!", "success");
        }, 1000);
      });

      // Fechar com ESC
      const handleEsc = (e) => {
        if (e.key === 'Escape') {
          instructions.remove();
          document.removeEventListener('keydown', handleEsc);
        }
      };
      document.addEventListener('keydown', handleEsc);
      
    }, 300);
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // KEYBOARD SHORTCUTS
  // ═══════════════════════════════════════════════════════════════════════════
  function handleKeyboard(e) {
    if (e.target.tagName === "INPUT" || e.target.tagName === "TEXTAREA") return;
    
    if (tourOverlay.classList.contains("active")) {
      if (e.key === "Escape") closeTour();
      if (e.key === "ArrowRight" || e.key === " ") { e.preventDefault(); nextTourStep(); }
      if (e.key === "ArrowLeft") prevTourStep();
      return;
    }

    if (e.key >= "1" && e.key <= "7") {
      const index = parseInt(e.key) - 1;
      if (nodeKeys[index]) {
        renderNodeDetails(nodeKeys[index]);
      }
    }

    switch(e.key.toLowerCase()) {
      case "t": startTour(); break;
      case "f": toggleFullscreen(); break;
      case "a": toggleAnimation(); break;
      case "r": resetView(); break;
      case "e": exportDiagram(); break;
      case "?":
      case "h":
        shortcutsHint.classList.toggle("visible");
        break;
      case "escape":
        if (isFullscreen) toggleFullscreen();
        shortcutsHint.classList.remove("visible");
        break;
    }
  }

  function resetView() {
    clearActiveStates();
    detailTitle.textContent = "Seleciona uma variável";
    detailBadge.textContent = "Modelo Conceptual";
    detailBadge.className = "details-badge badge-core";
    detailDescription.textContent = "Clica em qualquer variável do diagrama para explorar a sua definição, fontes de evidência, proposições teóricas associadas e revistas-alvo para publicação.";
    detailSources.innerHTML = `
      <span class="chip chip-methodology">Análise documental</span>
      <span class="chip chip-methodology">Entrevistas</span>
      <span class="chip chip-methodology">Estudo de caso</span>
    `;
    detailJournals.innerHTML = `
      <span class="chip chip-support">Tourism Management</span>
      <span class="chip chip-support">Journal of Sustainable Tourism</span>
      <span class="chip chip-support">Cities</span>
    `;
    detailReferences.innerHTML = '<span class="chip chip-ref">Seleciona uma variável</span>';
    showToast("🔄 Vista reposta", "info");
  }

  // ═══════════════════════════════════════════════════════════════════════════
  // EVENT LISTENERS
  // ═══════════════════════════════════════════════════════════════════════════
  document.querySelectorAll(".node").forEach(nodeEl => {
    nodeEl.addEventListener("click", () => {
      const key = nodeEl.getAttribute("data-node");
      renderNodeDetails(key);
    });
  });

  document.getElementById("btn-tour").addEventListener("click", startTour);
  document.getElementById("btn-fullscreen").addEventListener("click", toggleFullscreen);
  document.getElementById("btn-animate").addEventListener("click", toggleAnimation);
  document.getElementById("btn-reset").addEventListener("click", resetView);
  document.getElementById("btn-export").addEventListener("click", exportDiagram);

  document.getElementById("tour-close").addEventListener("click", closeTour);
  document.getElementById("tour-next").addEventListener("click", nextTourStep);
  document.getElementById("tour-prev").addEventListener("click", prevTourStep);

  document.addEventListener("keydown", handleKeyboard);

  let resizeTimeout;
  window.addEventListener("resize", () => {
    clearTimeout(resizeTimeout);
    resizeTimeout = setTimeout(drawConnections, 100);
  });

  // ═══════════════════════════════════════════════════════════════════════════
  // INITIALIZATION
  // ═══════════════════════════════════════════════════════════════════════════
  function init() {
    renderPropositions();
    
    setTimeout(() => {
      drawConnections();
      renderNodeDetails("RPP");
    }, 300);
  }

  init();

  setTimeout(() => {
    shortcutsHint.classList.add("visible");
    setTimeout(() => shortcutsHint.classList.remove("visible"), 4000);
  }, 1500);
</script>

</body>
</html>